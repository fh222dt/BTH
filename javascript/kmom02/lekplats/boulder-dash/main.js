/**
 * Boulder Dash game.
 */
$(document).ready(function(){
  'use strict';
  var  area = document.getElementById('flash'),
  player = document.getElementById('baddie1'),
  drawGame, movePlayer,
  posLeft = 0, 
  posTop = 0,
  gridSize = 24,
  tileSize = 32,
    
    /**
     * This is the background for the game area.
     */
    gameArea = [
      13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,16,16,14,12,16,17,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,16,17,14,17,13,15,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,15,15,13,14,12,16,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,15,15,17,17,16,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,17,17,15,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,17,17,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,16,13,14,12,13,14,17,16,16,16,13,14,12,13,14,19,21,
      13,14,12,13,14,12,13,14,12,13,14,17,13,14,12,16,16,12,13,19,18,18,21,21,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,17,12,13,19,18,21,21,21,21,21,
      14,12,13,14,12,13,14,12,13,14,12,13,14,15,16,14,12,20,21,21,21,21,21,21,
      13,14,12,13,14,12,13,14,12,13,14,12,13,15,15,13,19,21,21,21,21,21,21,21,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,20,21,21,21,21,21,21,21,
      14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,22,21,21,21,21,21,21,21,
      13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,22,21,21,21,21,21,21,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,22,21,21,21,21,21,
      14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,22,21,21,21,21,
    ],

    /**
     * These are blocks that cant be moved to, or something happens when you try to move on them.
     * The blocks are drawn "on top" of the gamearea. Block 10 is empty, should be 0 but looks nicer with two figures.
     */
    gameBlocks = [
      19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,
      19,10,10,10,10,10,10,13,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,13,13,13,13,13,13,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,13,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,13,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,13,10,10,10,10,19,
      19,10,13,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,10,10,10,19,
      19,10,13,13,13,13,13,13,13,13,10,10,10,10,10,10,10,12,12,12,10,10,10,19,
      19,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,13,10,12,12,10,10,10,19,
      19,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,13,10,12,12,10,10,10,19,
      19,10,10,10,10,10,11,11,11,12,11,11,10,10,10,10,13,10,10,10,10,10,10,19,
      19,10,10,10,10,10,10,10,10,10,11,11,10,10,10,10,13,10,10,10,10,10,10,19,
      19,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,10,19,
      19,10,10,10,10,10,10,10,10,10,10,10,10,13,13,10,10,10,10,10,10,10,10,19,
      19,10,10,11,10,10,10,10,10,10,10,10,10,13,13,10,10,10,10,10,10,10,10,19,
      19,10,10,11,10,10,12,12,11,11,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,10,11,10,10,12,12,10,11,13,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,10,11,10,10,12,14,10,10,13,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,10,11,10,10,13,10,13,13,13,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,10,11,11,11,13,13,11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,18,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,19,
      19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,
    ];

    drawGame = function(gameArea, gameBlocks) {    
      var i,e,b;
      for(i = 0; i < gameArea.length; i++) {
        e = document.createElement('div');
        e.innerHTML = '';
        e.className = 'tile t' + gameArea[i] + (gameBlocks[i] ? ' b' + gameBlocks[i] : '');
        e.id = 'n' + i;
        area.appendChild(e);
      }
    };

    movePlayer = function(moveLeft, moveTop, which) {
      function moveIt() {
        player.style.left = (area.offsetLeft + posLeft*tileSize + tileSize/2) + 'px';
        player.style.top  = (area.offsetTop + posTop*tileSize + tileSize/2) + 'px';
      };

      if(which) { player.className='baddie ' + which; }

      if(!(gameBlocks[(posLeft+moveLeft)+(posTop+moveTop)*gridSize]-10)) {
        posLeft += moveLeft; 
        posTop  += moveTop;
        moveIt();
      } 
      else {
        console.log('Block detected, cant move.');
      }
    };

  
  document.onkeydown = function(event) {
    var key;
    key = event.keyCode || event.which;
    switch(key) {
      case 37: movePlayer(-1, 0, 'left'); break;
      case 39: movePlayer(1, 0, 'right'); break;
      case 38: movePlayer(0, -1, 'up'); break;
      case 40: movePlayer(0, 1, 'down'); break; 
      default: movePlayer(0, 0, 'down'); break;
    };
    
  };

    
  
    //makes it all happen
    var init = function(){
      drawGame(gameArea, gameBlocks);
      movePlayer(1, 1, 'down');
    }
    init();
    console.log('Everything is ready.');  
});
